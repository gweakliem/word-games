// jooq plugin is tough to use via Kotlin until https://github.com/etiennestuder/gradle-jooq-plugin/pull/91

jooq {
  version = "3.12.1"
  edition = "OSS"

  primaryDb(sourceSets.main) {
    jdbc {
      driver = "org.postgresql.Driver"
      url = project.ext.jdbcUrl
      user = project.ext.dbUser
      password = project.ext.dbPass
    }
    generator {
      target {
        packageName = "org.mpierce.ktordemo.jooq"
      }
      database {
        inputSchema = "public"
        excludes = "flyway_schema_history"
      }
      generate {
        generatedAnnotation = false
      }
    }
  }
}

compileKotlin.dependsOn(generatePrimaryDbJooqSchemaSource)
generatePrimaryDbJooqSchemaSource.dependsOn(flywayMigrate)
